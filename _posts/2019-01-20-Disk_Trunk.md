---
title: "파일을 삭제하지 않고 디스크 용량을 확보하는 방법"
date: 2019-01-20 20:00:00 0000
categories: Linux
---

 첫 번째로 포스팅할 내용은 파일을 삭제하지 않고 디스크 용량을 확보하는 방법에 대해 작성해보겠습니다.

일반적으로 파일을 지우게 되면 지워진 파일만큼 디스크 용량이 확보됩니다. 하지만 프로세스에서 파일을 open하고 정상적으로 close를 해주지 않고 해당 파일을 삭제하게 되는 경우 파일을 지우더라도 디스크 용량을 확보할수 없는 문제가 발생하게 됩니다.

위와 같은 경우 해결책은 프로세스를 종료하게 되면 사용하고 있던 자원을 반환하게 되면서 open하고 close하지 못한 파일들도 정상적으로 반환을 하게 되면서 해결이 됩니다.

문제가 발생하는 경우는 프로세스를 재시작할 수 없는 서버 데몬 프로세스의 경우가 해당됩니다. 제가 이 내용에 대해 알게된 것도 서버의 로그 파일들을 쓰는 프로세스들이 정상적으로 파일을 close하지 못해 서버의 용량이 확보되지 않아 해결방법을 찾다가 알게 됐습니다.

먼저 파일은 지웠는데 정상적으로 close해주지 못한 것을 찾는 방법에 대해서 설명드리겠습니다.


lsof | grep deleted
/usr/sbin/lsof | grep deleted 

파일디스크립터를 다루는 lsof 명령어에서 deleted라는 단어로 grep을 하게 되면 파일은 지웠지만 close하지 않은 파일들의 리스트가 나타납니다.

![Image Alt 텍스트](/assets/img/file_open_test_01.png)
![Image Alt 텍스트](/assets/img/file_open_test_02.png)



다음은 이 파일들의 용량을 확보하는 방법입니다.

프로세스를 종료할수 있는 경우는 종료하는 방법이 가장 깔끔합니다.


하지만 데몬과 같이 종료를 할 수 없는 경우 아래와 같은 방법을 시도하면 프로세스를 종료하지 않고 용량을 확보할수 있습니다.

: > truncate 






